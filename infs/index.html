<!DOCTYPE html>
<html>
  <head>
    <title>Cálculo de Impostos - NF de Serviço</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="w-full h-full flex justify-center items-center bg-neutral-500 py-48">
      <div class="bg-white border border-gray-300 p-6 rounded-xl shadow-xl">
        <h1 class="text-2xl font-bold text-center mb-6">Cálculo de Impostos - NF de Serviço</h1>
      
        <div class="mb-6">
          <label for="valor-servico" class="text-gray-700">Valor do Serviço:</label>
          <input type="text" id="valor-servico" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
        </div>
      
        <div class="mb-6">
          <label for="tipo-empresa" class="text-gray-700">Tipo de Empresa:</label>
          <select id="tipo-empresa" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
            <option value="microempresa">Microempresa (Simples Nacional)</option>
            <option value="empresa-geral">Empresa (Geral)</option>
          </select>
        </div>
      
        <div class="mb-6">
          <label for="faixa-faturamento" class="text-gray-700">Faixa de Faturamento (Microempresa):</label>
          <select id="faixa-faturamento" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
            <option value="0">Até R$ 180.000</option>
            <option value="180000">R$ 180.000 - R$ 360.000</option>
            <option value="360000">R$ 360.000 - R$ 720.000</option>
            <option value="720000">R$ 720.000 - R$ 1.800.000</option>
            <option value="1800000">R$ 1.800.000 - R$ 3.600.000</option>
            <option value="3600000">R$ 3.600.000 - R$ 4.800.000</option>
            <option value="4800000">R$ 4.800.000 - R$ 6.000.000</option>
            <option value="6000000">R$ 6.000.000 - R$ 7.200.000</option>
            <option value="7200000">R$ 7.200.000 - R$ 8.400.000</option>
            <option value="8400000">R$ 8.400.000 - R$ 9.600.000</option>
            <option value="9600000">R$ 9.600.000 - R$ 10.800.000</option>
            <option value="10800000">R$ 10.800.000 - R$ 12.000.000</option>
            <option value="12000000">R$ 12.000.000 - R$ 24.000.000</option>
            <option value="24000000">Acima de R$ 24.000.000</option>
          </select>
        </div>
        
        <div class="mb-6">
          <label for="regime-pis" class="text-gray-700">Regime PIS:</label>
          <select id="regime-pis" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
            <option value="cumulativo">Cumulativo</option>
            <option value="nao-cumulativo">Não Cumulativo</option>
          </select>
        </div>

        <div class="mb-6">
          <label for="regime-cofins" class="text-gray-700">Regime COFINS:</label>
          <select id="regime-cofins" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500">
            <option value="cumulativo">Cumulativo</option>
            <option value="nao-cumulativo">Não Cumulativo</option>
          </select>
        </div>
      
        <div class="text-center">
          <button id="calcular" class="bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2">Calcular Impostos</button>
        </div>
      
        <h2 class="text-lg font-semibold mt-8 mb-4">Resultados:</h2>
        <div id="resultado-pis" class="mb-2"></div>
        <div id="resultado-cofins" class="mb-2"></div>
        <div id="resultado-csll" class="mb-2"></div>
        <div id="resultado-iss" class="mb-2"></div>
        <div id="resultado-irpj" class="mb-2"></div>
        <div id="total-impostos" class="mb-2"></div>
        <div id="valor-total"></div>
      </div>
      
    </div>

    <script src="https://cdn.jsdelivr.net/npm/inputmask/dist/inputmask.min.js"></script>
    <script src="./calculoNotaServico.js"></script>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
      var valorServico = document.getElementById('valor-servico');
        var inputMaskOptions = {
          prefix: 'R$ ',
          groupSeparator: '.',
          radixPoint: ',',
          allowNegative: false,
          autoGroup: true,
          digits: 2,
          digitsOptional: false,
          rightAlign: false,
          unmaskAsNumber: true
        };
        new Inputmask('currency', inputMaskOptions).mask(valorServico);
      });

      function getValue(){
        const valorServicoInput = document.getElementById('valor-servico');
        const valorServicoRaw = valorServicoInput.inputmask.unmaskedvalue(); // Get the raw unmasked value
        const valorServicoString = String(valorServicoRaw); // Convert to string
        const valorServico = parseFloat(valorServicoString.replace(',', '.')); // Remove the group separator and replace the radix point

        const regimePIS = document.getElementById('regime-pis').value;
        const regimeCOFINS = document.getElementById('regime-cofins').value;
        const tipoEmpresa = document.getElementById('tipo-empresa').value;
        const faixaFaturamento = document.getElementById('faixa-faturamento').value;

        calcularImpostos(valorServico, regimePIS, regimeCOFINS, tipoEmpresa, faixaFaturamento)
          .then((resultados) => {
            exibirResultados(resultados);
          })
          .catch((error) => {
            console.error(error);
          });
      }

      var btnCalcular = document.getElementById("calcular");

      btnCalcular.addEventListener("click", getValue);
    </script>
  </body>
</html>
